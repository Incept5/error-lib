jdk:
  - openjdk21
before_install:
  - ./gradlew clean
install:
  # Extract version from git tag (JitPack sets the version based on the git tag)
  - if [ -n "$VERSION" ]; then
      echo "Using provided version: $VERSION";
    elif [ -n "$(git tag --points-at HEAD)" ]; then
      VERSION=$(git describe --tags --abbrev=0 | sed 's/^v//');
      echo "Using git tag version: $VERSION";
    else
      VERSION=$(git rev-parse --short HEAD);
      echo "Using commit hash as version: $VERSION";
    fi
  - echo "Building version $VERSION"
  
  # Ensure we're using the correct group ID
  - ./gradlew build publishToMavenLocal -Pgroup=com.github.incept5 -Pversion=$VERSION
  
  # Debug information
  - echo "Published artifacts to local Maven repository"
  - echo "Maven repository location: $HOME/.m2/repository"
  - echo "Verifying error-core artifacts:"
  - find $HOME/.m2/repository -name "error-core*" | grep "com/github/incept5" || echo "No error-core artifacts found"
  - echo "Verifying error-quarkus artifacts:"
  - find $HOME/.m2/repository -name "error-quarkus*" | grep "com/github/incept5" || echo "No error-quarkus artifacts found"
  
  # Verify that both JARs exist with more detailed error messages
  - if [ ! -f $HOME/.m2/repository/com/github/incept5/error-core/$VERSION/error-core-$VERSION.jar ]; then
      echo "ERROR: error-core JAR not found at $HOME/.m2/repository/com/github/incept5/error-core/$VERSION/error-core-$VERSION.jar";
      echo "Contents of directory:";
      ls -la $HOME/.m2/repository/com/github/incept5/error-core/$VERSION/ || echo "Directory does not exist";
      exit 1;
    else
      echo "Found error-core JAR at $HOME/.m2/repository/com/github/incept5/error-core/$VERSION/error-core-$VERSION.jar";
    fi
  
  - if [ ! -f $HOME/.m2/repository/com/github/incept5/error-quarkus/$VERSION/error-quarkus-$VERSION.jar ]; then
      echo "ERROR: error-quarkus JAR not found at $HOME/.m2/repository/com/github/incept5/error-quarkus/$VERSION/error-quarkus-$VERSION.jar";
      echo "Contents of directory:";
      ls -la $HOME/.m2/repository/com/github/incept5/error-quarkus/$VERSION/ || echo "Directory does not exist";
      exit 1;
    else
      echo "Found error-quarkus JAR at $HOME/.m2/repository/com/github/incept5/error-quarkus/$VERSION/error-quarkus-$VERSION.jar";
    fi
